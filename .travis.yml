os: linux
dist: bionic
language: generic
addons:
  apt:
    packages:
      - libgmp-dev
env:
  global:
    - HACKAGE_USERNAME=fozworth
    # HACKAGE_PASSWORD
    - secure: e6UL1h4KJ8f8ONHXf7KN/vpVQg9+44fIvwrOF5eh/KMUTw5DwhFkolPVU/eIHXZ1FB61++K4iuZF44m96ql6CFJSILjH9BgPMs8hxiCEorOYWcpVJ7lvj0lVZYqfuR2+uVYa3OXzl1MMEgtLlD/B1M3CMHTIZNf4Q/zlEmkxwPg9ehbeteJ3Xb/BqozFc/oX9ivfAyfEvNhEtiWvikXFvGVvjKcOJpH/asppJLRwGHKIfvwSG4NXdSkDhj2vjoOOCxyKHj3cYJSyElgF6ISIHl+gc2D1uycRqO47IPvlqiIg06hIcfjDMO2GicHekx9OMs+h8caZPwb7854Rz8x1fyJsuRyK7ZRwfxr4U6oRgCmwdY42+TObSC/Ky3BE+MX3YS65nYStLqVJMlwf+ydv2nAM0CMAzSwwAY062FbQRgC7RYOty94Ego68WzvVp9XVHakulkHT4/AytQDJwDzMATMxqrI43oBLwt4QRKafSi91T7Mm9aE7NB3ezeHjxIOxdBp2qWCT25s+GWMwnYYVhjNjFfAD0wYrU1tyU7qL5cMCLLwEEtY07SpKQF1h4+jFqCOLSuuRsV4Iu7qv0PphH428Y5gGOgqnVhm9sg+ZVt72Zy4zoBQimXOeL15eAO4XUljVP5l33BgjID073iR9ZzyI8y3lv+ERGNW7JOKhmJk=

cache:
  directories:
    - $HOME/.local/bin
    - $HOME/.stack

before_install:
  - |
    if ! test -f "$HOME/.local/bin/stack"
    then
      VERSION=2.3.0.1
      URL="https://github.com/commercialhaskell/stack/releases/download/v$VERSION/stack-$VERSION-linux-x86_64-static.tar.gz"
      curl --location --output stack.tar.gz "$URL"
      gunzip stack.tar.gz
      tar --extract --file stack.tar --strip-components 1
      mkdir --parents "$HOME/.local/bin"
      mv stack "$HOME/.local/bin"
      rm stack.tar
    fi
  - stack --version

install:
  - stack setup
  - stack build --only-dependencies --test

script:
  - stack build --no-run-tests --pedantic --test
  - stack build --test
  - stack sdist

deploy:
  provider: script
  on:
    tags: true
  skip_cleanup: true
  script: yes | stack upload .
